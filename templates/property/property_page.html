{% extends 'base.html'%}
{% load crispy_forms_tags %}
{% load static %}

{% block extend_head %}
<link rel="stylesheet" href="{% static 'css/login.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <!-- TODO: need to use a loop to display images for each specific property, not just a static amount like right now  -->
    <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"
                aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"
                aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"
                aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
            <div class="carousel-item active">
                {% if listing.photo_url %}
                <img src="{{listing.photo_url.url}}" class="d-block w-100" alt="..." style="width: 100%; height:750px;">
                {% else %}
                <img src="https://via.placeholder.com/300" class="img-fluid rounded-start" alt="...">
                {% endif %}
                <div class="carousel-caption d-none d-md-block">
                    <h5>Sell traditionally with an agent</h5>
                    <p>When you work with a real estate agent, you'll get selling support at every step, from prepping
                        and listing your home to marketing that gets buyers in the door.</p>
                </div>
            </div>
        </div>
        <div class="carousel-item">
            {% if listing.photo_url2 %}
            <img src="{{listing.photo_url2.url}}" class="d-block w-100" alt="..." style="width: 100%; height:750px;">
            {% else %}
            <img src="https://via.placeholder.com/300" class="img-fluid rounded-start" alt="...">
            {% endif %}
            <div class="carousel-caption d-none d-md-block">
                <h5>Sell your home with a trusted local agent</h5>
                <p>It's easy to sell your home when we connect you with a participating Zillow Premier Agent partner.
                    Start by entering your address to see if they're available in your area. They'll be in more places
                    soon!</p>
            </div>
        </div>
        <div class="carousel-item">
            {% if listing.photo_url3 %}
            <img src="{{listing.photo_url3.url}}" class="d-block w-100" alt="..." style="width: 100%; height:750px;">
            {% else %}
            <img src="https://via.placeholder.com/300" class="img-fluid rounded-start" alt="...">
            {% endif %}
            <div class="carousel-caption d-none d-md-block">
                <h5>Sell your home yourself</h5>
                <p>Deciding to sell your home yourself is referred to as for-sale-by-owner (FSBO). The FSBO process is
                    similar to traditional selling, but without the help of a real estate agent. In this case, youâ€™re
                    responsible for the home prep,
                    marketing, showings, and negotiations.</p>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions"
            data-bs-slide="prev" style="background: transparent;">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions"
            data-bs-slide="next" style="background: transparent;">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>

    <!-- Property Location -->
    <span class="">{{listing.address1}}</span><br>
    <span class="">{{listing.borough}}, NY {{listing.zipcode}}</span><br><br>

    <!-- Property Description and Information -->
    <h5 class=""><b>Description</b></h5>
    <p style="font-size:14px">{{listing.description}}</p><br>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general"
                type="button" role="tab" aria-controls="general" aria-selected="true">General</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="accommodations-tab" data-bs-toggle="tab" data-bs-target="#accommodations"
                type="button" role="tab" aria-controls="accommodations" aria-selected="false">Accommodations</button>
        </li>
    </ul>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
            <li class="list-group-item"><i class="fa-solid fa-dollar fa-fw"></i> Rent: ${{listing.rent}}</li>
            <li class="list-group-item"><i class="fa-solid fa-ruler fa-fw"></i> Area: {{listing.area}} sq. ft</li>
            <li class="list-group-item"><i class="fa-solid fa-bed fa-fw"></i> Bedrooms: {{listing.bedrooms}}</li>
            <li class="list-group-item"><i class="fa-solid fa-shower fa-fw"></i> Bathrooms: {{listing.bathrooms}}</li>
            <li class="list-group-item"><i class="fa-solid fa-star fa-fw"></i> Rating: {{listing.ratings}}</li>
        </div>
        <div class="tab-pane fade" id="accommodations" role="tabpanel" aria-labelledby="accommodations-tab">
            <li class="list-group-item"><i class="fa-solid fa-couch fa-fw"></i> Furnished:
                {{listing.furnished| yesno:"Yes,No"}}</li>
            <li class="list-group-item"><i class="fa-solid fa-elevator fa-fw"></i> Elevator:
                {{listing.elevator| yesno:"Yes,No"}}</li>
            <li class="list-group-item"><i class="fa-solid fa-temperature-arrow-up fa-fw"></i> Heating:
                {{listing.heating| yesno:"Yes,No"}}</li>
            <li class="list-group-item"><i class="fa-solid fa-car fa-fw"></i> Parking:
                {{listing.parking| yesno:"Yes,No"}}</li>
            <li class="list-group-item"><i class="fa-solid fa-shirt fa-fw"></i> Laundry:
                {{listing.laundry| yesno:"Yes,No"}}</li>
        </div>
    </div>

    <br>

    <!-- Additional Property Information -->
    <div class="panel-group" id="accordion">
        <h5 class=""><b>Additional Information for {{listing.address1}}</b></h5>

        <h6>Virtual Tour</h6>
        {% if not listing.matterport_link %}
        <a class="btn btn-secondary disabled btn-block" href="#" role="button">VR Tour Unavailable</a>
        {% else %}
        <a class="btn btn-secondary btn-block " href="{{listing.matterport_link}}" role="button">VR Tour</a>
        {% endif %}<br><br>

        <h6>Schedule an Appointment</h6>
        {% if messages %}
        {% for message in messages %}
        {% if message.tags == 'error' %}
        <div class="alert alert-danger my-2" role="alert">
            {{message}}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        {% if messages %}
        {% for message in messages %}
        {% if message.tags == 'info' %}
        <div class="alert alert-info my-2" role="alert">
            {{message}}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
        <form class="needs-validation" id='requestTourForm' method="POST" enctype="multipart/form-data" multiple
            action="/property/{{listing.listing_id}}" novalidate>
            {% csrf_token %}
            {% crispy form %}
        </form>

        <script>
            (function () {
                'use strict';
                window.addEventListener('load', function () {
                    // Fetch all the forms we want to apply custom Bootstrap validation styles to
                    var forms = document.getElementsByClassName('needs-validation');
                    // Loop over them and prevent submission
                    var validation = Array.prototype.filter.call(forms, function (form) {
                        form.addEventListener('submit', function (event) {
                            if (form.checkValidity() === false) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                            form.classList.add('was-validated');
                        }, false);
                    });
                }, false);
            })();
        </script>

        <br><br>

        <h6>Check Previous Years Price Trends Of All Neighborhoods Accross {{listing.borough}}!</h6>
        <a class="btn btn-primary" href="{% url 'property:charts' listing.borough %}"" role=" button"> View Trends </a>


        <br><br>
        <br><br>

        <h6>Rate and Review this property!</h6>
        {% if messages %}
        {% for message in messages %}
        {% if message.tags == 'warning' %}
        <div class="alert alert-danger my-2" role="alert">
            {{message}}
        </div>
        {% endif %}
        {% endfor %}
        {% endif %}
    </div>
    <div class="container" style="padding: 2%;">
        <div class="">
            <form id='ratingsform' method="POST" action="{% url 'property:newrating' property_id %}">
                {% csrf_token %}
                <label for="rating_value" class="form-label">Rating (0 - 5)</label>
                <input name="rating_value" type="range" class="form-range" min="0" max="5" step="0.5" id="rating_value">
                <button type="submit" class="btn btn-success">Submit</button>
            </form>
        </div>
        <br>
        <div class="list-group">
            {% for comment in comments %}
            <a href="#" class="list-group-item list-group-item-action" aria-current="true">
                <div class="d-flex w-100 justify-content-between">
                    <h5 class="mb-1">{{comment.text}}</h5>
                    <small>{{comment.created_at}}</small>
                </div>
                <small>- {{comment.user.first_name}} {{comment.user.last_name}}</small>
            </a>
            {% endfor %}
        </div>
    </div>
    <div class="">
        <div class="container" style="padding: 2%;">
            <form id='listingform' method="POST" enctype="multipart/form-data"
                action="{% url 'property:newcomment' property_id %}">
                {% load crispy_forms_tags %}
                {% csrf_token %}
                {{ comment_form|crispy}}
                <button type="submit" class="btn btn-success">Submit</button>
            </form>

        </div>

    </div>


</div>
{% endblock %}